<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="NutritionApp.Views.ProfilePage"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{StaticResource PageBackground}">

    <Grid RowDefinitions="260,*" Padding="0">

        <!-- –í–µ—Ä—Ö–Ω—ñ–π –±–ª–æ–∫ –∑ –≥—Ä–∞–¥—ñ—î–Ω—Ç–æ–º -->
        <Grid Row="0" Padding="0,16,0,16">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#4F7DFF" Offset="0.0" />
                    <GradientStop Color="#E27D5F" Offset="1.0" />
                </LinearGradientBrush>
            </Grid.Background>

            <VerticalStackLayout Spacing="14"
                                 VerticalOptions="Center"
                                 HorizontalOptions="Center">
                <!-- –ê–≤–∞—Ç–∞—Ä —É –∫—Ä—É–≥—É –∑–≤–µ—Ä—Ö—É - —Ç–µ–ø–µ—Ä –Ω–∞—Ç–∏—Å–∫–∞—î—Ç—å—Å—è -->
                <Border HeightRequest="96"
                        WidthRequest="96"
                        Stroke="#FFFFFF33"
                        StrokeThickness="1.5"
                        StrokeShape="RoundRectangle 52"
                        BackgroundColor="#FFFFFF22"
                        HorizontalOptions="Center">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnAvatarTapped"/>
                    </Border.GestureRecognizers>
                    <Image x:Name="AvatarImage"
                           Source="{Binding SelectedAvatar.ImageSource}"
                           HeightRequest="90"
                           WidthRequest="90"
                           Aspect="AspectFill"/>
                </Border>

                <!-- –ü—ñ–¥–∫–∞–∑–∫–∞ -->
                <Label Text="(–Ω–∞—Ç–∏—Å–Ω–∏ –¥–ª—è –∑–º—ñ–Ω–∏ –∞–≤–∞—Ç–∞—Ä–∞)"
                       FontSize="11"
                       TextColor="#FFFFFFAA"
                       HorizontalOptions="Center"/>

                <Label x:Name="UsernameLabel"
                       Text="{Binding UserProfile.Username, StringFormat='–í—ñ—Ç–∞—î–º–æ, {0}!'}"
                       FontAttributes="Bold"
                       FontSize="22"
                       TextColor="White"
                       HorizontalOptions="Center"/>

                <Label Text="–¢–≤—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å —Ç–∞ –ø–æ–∫–∞–∑–Ω–∏–∫–∏"
                       FontSize="14"
                       TextColor="#FFEFF2"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>
        </Grid>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
        <Border Grid.Row="1"
                BackgroundColor="{StaticResource CardBackground}"
                Stroke="{StaticResource BorderColor}"
                StrokeThickness="1"
                Padding="20"
                Margin="16,-32,16,0"
                StrokeShape="RoundRectangle 24">

            <ScrollView>
                <VerticalStackLayout Spacing="18">

                    <!-- –ö–Ω–æ–ø–∫–∏ –¥—ñ–π -->
                    <Grid ColumnDefinitions="*,*"
                          ColumnSpacing="10">
                        <Button Text="Edit profile"
                                Clicked="OnEditProfileClicked"
                                HeightRequest="48"
                                CornerRadius="14"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White"
                                FontAttributes="Bold"/>

                        <Button Grid.Column="1"
                                Text="Logout"
                                Clicked="OnLogoutButtonClicked"
                                HeightRequest="48"
                                CornerRadius="14"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Primary}"
                                BorderColor="{StaticResource Primary}"
                                BorderWidth="1.2"/>
                    </Grid>

                    <!-- –ë–ª–æ–∫ –∑ –æ—Å–Ω–æ–≤–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ -->
                    <VerticalStackLayout Spacing="12">
                        <Label Text="–ú–æ—ó –ø–æ–∫–∞–∑–Ω–∏–∫–∏"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextPrimary}"/>

                        <Grid ColumnDefinitions="*,*"
                              RowSpacing="12"
                              ColumnSpacing="12">

                            <Border Stroke="{StaticResource BorderColor}"
                                    BackgroundColor="{StaticResource CardBackground}"
                                    StrokeThickness="1"
                                    StrokeShape="RoundRectangle 14"
                                    Padding="12">
                                <VerticalStackLayout Spacing="4">
                                    <Label Text="Height"
                                           FontSize="13"
                                           TextColor="{StaticResource TextSecondary}"/>
                                    <Label Text="{Binding UserProfile.Height, StringFormat='{0} —Å–º'}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}"/>
                                </VerticalStackLayout>
                            </Border>

                            <Border Grid.Column="1"
                                    Stroke="{StaticResource BorderColor}"
                                    BackgroundColor="{StaticResource CardBackground}"
                                    StrokeThickness="1"
                                    StrokeShape="RoundRectangle 14"
                                    Padding="12">
                                <VerticalStackLayout Spacing="4">
                                    <Label Text="Weight"
                                           FontSize="13"
                                           TextColor="{StaticResource TextSecondary}"/>
                                    <Label Text="{Binding UserProfile.Weight, StringFormat='{0} –∫–≥'}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}"/>
                                </VerticalStackLayout>
                            </Border>

                            <Border Grid.Row="1"
                                    Stroke="{StaticResource BorderColor}"
                                    BackgroundColor="{StaticResource CardBackground}"
                                    StrokeThickness="1"
                                    StrokeShape="RoundRectangle 14"
                                    Padding="12">
                                <VerticalStackLayout Spacing="4">
                                    <Label Text="Age"
                                           FontSize="13"
                                           TextColor="{StaticResource TextSecondary}"/>
                                    <Label Text="{Binding UserProfile.Age, StringFormat='{0} —Ä–æ–∫—ñ–≤'}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}"/>
                                </VerticalStackLayout>
                            </Border>

                            <Border Grid.Row="1" Grid.Column="1"
                                    Stroke="{StaticResource BorderColor}"
                                    BackgroundColor="{StaticResource CardBackground}"
                                    StrokeThickness="1"
                                    StrokeShape="RoundRectangle 14"
                                    Padding="12">
                                <VerticalStackLayout Spacing="4">
                                    <Label Text="Activity"
                                           FontSize="13"
                                           TextColor="{StaticResource TextSecondary}"/>
                                    <Label Text="{Binding UserProfile.ActivityLevel}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}"
                                           LineBreakMode="TailTruncation"/>
                                </VerticalStackLayout>
                            </Border>

                            <Border Grid.Row="2" Grid.ColumnSpan="2"
                                    Stroke="{StaticResource BorderColor}"
                                    BackgroundColor="{StaticResource CardBackground}"
                                    StrokeThickness="1"
                                    StrokeShape="RoundRectangle 14"
                                    Padding="12">
                                <VerticalStackLayout Spacing="4">
                                    <Label Text="Goal"
                                           FontSize="13"
                                           TextColor="{StaticResource TextSecondary}"/>
                                    <Label Text="{Binding UserProfile.Goal}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}"/>
                                </VerticalStackLayout>
                            </Border>
                        </Grid>
                    </VerticalStackLayout>

                    <!-- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -->
                    <Label Text="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}"
                           Margin="0,8,0,0"/>

                    <!-- –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –≤–æ–¥—É -->
                    <Border Stroke="{StaticResource BorderColor}"
                            BackgroundColor="{StaticResource CardBackground}"
                            StrokeThickness="1"
                            StrokeShape="RoundRectangle 14"
                            Padding="14">
                        <VerticalStackLayout Spacing="12">
                            <Grid ColumnDefinitions="Auto,*,Auto" VerticalOptions="Center">
                                <Border WidthRequest="40" 
                                        HeightRequest="40"
                                        StrokeShape="RoundRectangle 20"
                                        BackgroundColor="#E0F2FE"
                                        Stroke="Transparent">
                                    <Label Text="üíß" 
                                           FontSize="18" 
                                           VerticalOptions="Center" 
                                           HorizontalOptions="Center"/>
                                </Border>
                                <VerticalStackLayout Grid.Column="1" Margin="12,0,0,0" VerticalOptions="Center">
                                    <Label Text="–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –≤–æ–¥—É"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}"/>
                                    <Label Text="–†–µ–≥—É–ª—è—Ä–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø–∏—Ç–∏ –≤–æ–¥—É"
                                           FontSize="12"
                                           TextColor="{StaticResource TextSecondary}"/>
                                </VerticalStackLayout>
                                <Switch x:Name="WaterReminderSwitch"
                                        Grid.Column="2"
                                        Toggled="OnWaterReminderToggled"
                                        VerticalOptions="Center"/>
                            </Grid>

                            <!-- –í–∏–±—ñ—Ä —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É (–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ) -->
                            <Border x:Name="IntervalPickerContainer"
                                    IsVisible="False"
                                    Stroke="{StaticResource BorderColor}"
                                    StrokeThickness="1"
                                    StrokeShape="RoundRectangle 10"
                                    BackgroundColor="{StaticResource PageBackground}"
                                    Padding="4,0">
                                <Picker x:Name="IntervalPicker"
                                        Title="–Ü–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å"
                                        SelectedIndexChanged="OnIntervalChanged"
                                        TextColor="{StaticResource TextPrimary}"
                                        TitleColor="{StaticResource TextSecondary}">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>–ö–æ–∂–Ω—ñ 30 —Ö–≤–∏–ª–∏–Ω</x:String>
                                            <x:String>–ö–æ–∂–Ω—ñ 45 —Ö–≤–∏–ª–∏–Ω</x:String>
                                            <x:String>–ö–æ–∂–Ω—ñ 60 —Ö–≤–∏–ª–∏–Ω</x:String>
                                            <x:String>–ö–æ–∂–Ω—ñ 90 —Ö–≤–∏–ª–∏–Ω</x:String>
                                            <x:String>–ö–æ–∂–Ω—ñ 2 –≥–æ–¥–∏–Ω–∏</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                            </Border>
                        </VerticalStackLayout>
                    </Border>

                    <!-- –ü–µ—Ä–µ–º–∏–∫–∞—á —Ç–µ–º–∏ -->
                    <Border Stroke="{StaticResource BorderColor}"
                            BackgroundColor="{StaticResource CardBackground}"
                            StrokeThickness="1"
                            StrokeShape="RoundRectangle 14"
                            Padding="14">
                        <Grid ColumnDefinitions="Auto,*,Auto" VerticalOptions="Center">
                            <Border WidthRequest="40" 
                                    HeightRequest="40"
                                    StrokeShape="RoundRectangle 20"
                                    BackgroundColor="#FEF3C7"
                                    Stroke="Transparent">
                                <Label Text="üåô" 
                                       FontSize="18" 
                                       VerticalOptions="Center" 
                                       HorizontalOptions="Center"/>
                            </Border>
                            <VerticalStackLayout Grid.Column="1" Margin="12,0,0,0" VerticalOptions="Center">
                                <Label Text="–¢–µ–º–Ω–∞ —Ç–µ–º–∞"
                                       FontSize="15"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource TextPrimary}"/>
                                <Label Text="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ñ–æ–Ω –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É"
                                       FontSize="12"
                                       TextColor="{StaticResource TextSecondary}"/>
                            </VerticalStackLayout>
                            <Switch x:Name="ThemeSwitch"
                                    Grid.Column="2"
                                    Toggled="OnThemeToggled"
                                    VerticalOptions="Center"/>
                        </Grid>
                    </Border>

                </VerticalStackLayout>
            </ScrollView>
        </Border>

        <!-- Popup –¥–ª—è –≤–∏–±–æ—Ä—É –∞–≤–∞—Ç–∞—Ä–∞ -->
        <Grid x:Name="AvatarPopup" 
              Grid.RowSpan="2"
              IsVisible="False"
              BackgroundColor="#80000000"
              ZIndex="100">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnClosePopup"/>
            </Grid.GestureRecognizers>

            <Border VerticalOptions="Center"
                    HorizontalOptions="Center"
                    BackgroundColor="{StaticResource CardBackground}"
                    Stroke="{StaticResource BorderColor}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 24"
                    Padding="24"
                    WidthRequest="300">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer/>
                </Border.GestureRecognizers>

                <VerticalStackLayout Spacing="16">
                    <Label Text="–û–±–µ—Ä–∏ –∞–≤–∞—Ç–∞—Ä"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}"
                           HorizontalOptions="Center"/>

                    <CollectionView ItemsSource="{Binding AvatarOptions}"
                                    SelectionMode="Single"
                                    SelectedItem="{Binding SelectedAvatar}"
                                    SelectionChanged="OnAvatarSelected"
                                    HorizontalOptions="Center"
                                    HeightRequest="160">
                        <CollectionView.ItemsLayout>
                            <GridItemsLayout Orientation="Vertical" 
                                             Span="4"
                                             HorizontalItemSpacing="8"
                                             VerticalItemSpacing="8"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border HeightRequest="60"
                                        WidthRequest="60"
                                        Stroke="{StaticResource BorderColor}"
                                        StrokeThickness="2"
                                        StrokeShape="RoundRectangle 30"
                                        BackgroundColor="#FFFFFF11"
                                        HorizontalOptions="Center">
                                    <Image Source="{Binding ImageSource}"
                                           HeightRequest="50"
                                           WidthRequest="50"
                                           Aspect="AspectFill"/>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <Button Text="–ó–∞–∫—Ä–∏—Ç–∏"
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="White"
                            CornerRadius="12"
                            HeightRequest="44"
                            Clicked="OnClosePopup"/>
                </VerticalStackLayout>
            </Border>
        </Grid>

    </Grid>
</ContentPage>