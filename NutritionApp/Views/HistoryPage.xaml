<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:NutritionApp.ViewModels"
             xmlns:models="clr-namespace:NutritionApp.Models"
             x:DataType="viewModels:HistoryViewModel"
             x:Class="NutritionApp.Views.HistoryPage"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{StaticResource PageBackground}">

    <Grid RowDefinitions="180,*" Padding="0">

        <!-- Ð’ÐµÑ€Ñ…Ð½Ñ–Ð¹ Ð±Ð»Ð¾Ðº Ð· Ð³Ñ€Ð°Ð´Ñ–Ñ”Ð½Ñ‚Ð¾Ð¼ -->
        <Grid Row="0" Padding="0,16,0,16">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#4F7DFF" Offset="0.0" />
                    <GradientStop Color="#E27D5F" Offset="1.0" />
                </LinearGradientBrush>
            </Grid.Background>

            <VerticalStackLayout Spacing="10"
                                 VerticalOptions="Center"
                                 HorizontalOptions="Center">
                <Label Text="ðŸ“‹" FontSize="40" HorizontalOptions="Center"/>
                <Label Text="Ð†ÑÑ‚Ð¾Ñ€Ñ–Ñ Ñ€Ð°Ñ†Ñ–Ð¾Ð½Ñ–Ð²"
                       FontAttributes="Bold"
                       FontSize="24"
                       TextColor="White"
                       HorizontalOptions="Center"/>
                <Label Text="Ð¢Ð²Ð¾Ñ— Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ñ– Ð¿Ð»Ð°Ð½Ð¸ Ñ…Ð°Ñ€Ñ‡ÑƒÐ²Ð°Ð½Ð½Ñ"
                       FontSize="14"
                       TextColor="#FFEFF2"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>
        </Grid>

        <!-- ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ -->
        <Border Grid.Row="1"
                BackgroundColor="{StaticResource CardBackground}"
                Stroke="{StaticResource BorderColor}"
                StrokeThickness="1"
                Padding="16"
                Margin="16,-32,16,16"
                StrokeShape="RoundRectangle 24">

            <Grid RowDefinitions="Auto,*">

                <!-- Ð†Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½Ñ -->
                <ActivityIndicator Grid.Row="0" 
                                   IsVisible="{Binding IsLoading}" 
                                   IsRunning="{Binding IsLoading}" 
                                   Color="{StaticResource Primary}"
                                   HorizontalOptions="Center" 
                                   Margin="0,20,0,10"/>

                <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ–ÑÑ‚Ð¾Ñ€Ñ–Ñ— -->
                <CollectionView Grid.Row="1" 
                                ItemsSource="{Binding MealPlans}" 
                                SelectionMode="None">

                    <!-- ÐŸÐ¾Ñ€Ð¾Ð¶Ð½Ñ–Ð¹ ÑÑ‚Ð°Ð½ -->
                    <CollectionView.EmptyView>
                        <VerticalStackLayout Spacing="16"
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center"
                                             Margin="0,60,0,0">
                            <Label Text="ðŸ“­" FontSize="60" HorizontalOptions="Center"/>
                            <Label Text="Ð†ÑÑ‚Ð¾Ñ€Ñ–Ñ Ð¿Ð¾Ñ€Ð¾Ð¶Ð½Ñ"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}"
                                   HorizontalOptions="Center"/>
                            <Label Text="Ð—Ð³ÐµÐ½ÐµÑ€ÑƒÐ¹ ÑÐ²Ñ–Ð¹ Ð¿ÐµÑ€ÑˆÐ¸Ð¹ Ð¿Ð»Ð°Ð½ Ñ…Ð°Ñ€Ñ‡ÑƒÐ²Ð°Ð½Ð½Ñ!"
                                   FontSize="14"
                                   TextColor="{StaticResource TextSecondary}"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:MealPlan">
                            <Border Stroke="{StaticResource BorderColor}"
                                    BackgroundColor="{StaticResource CardBackground}"
                                    StrokeThickness="1"
                                    StrokeShape="RoundRectangle 16"
                                    Padding="16"
                                    Margin="0,0,0,12">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:HistoryViewModel}}, Path=ViewPlanDetailsCommand}"
                                                          CommandParameter="{Binding .}"/>
                                </Border.GestureRecognizers>

                                <Grid ColumnDefinitions="Auto,*,Auto">

                                    <!-- Ð†ÐºÐ¾Ð½ÐºÐ° -->
                                    <Border WidthRequest="50" 
                                            HeightRequest="50"
                                            StrokeShape="RoundRectangle 25"
                                            BackgroundColor="#EFF6FF"
                                            Stroke="Transparent"
                                            VerticalOptions="Center">
                                        <Label Text="ðŸ½ï¸" 
                                               FontSize="22" 
                                               VerticalOptions="Center" 
                                               HorizontalOptions="Center"/>
                                    </Border>

                                    <!-- Ð†Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ -->
                                    <VerticalStackLayout Grid.Column="1" 
                                                         Margin="14,0,0,0"
                                                         VerticalOptions="Center"
                                                         Spacing="4">
                                        <Label Text="ÐŸÐ»Ð°Ð½ Ñ…Ð°Ñ€Ñ‡ÑƒÐ²Ð°Ð½Ð½Ñ"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource TextPrimary}"/>
                                        <Label Text="{Binding Date, StringFormat='{0:dd MMMM yyyy, HH:mm}'}"
                                               FontSize="13"
                                               TextColor="{StaticResource TextSecondary}"/>
                                    </VerticalStackLayout>

                                    <!-- Ð¡Ñ‚Ñ€Ñ–Ð»ÐºÐ° -->
                                    <Label Grid.Column="2"
                                           Text="â€º"
                                           FontSize="28"
                                           TextColor="{StaticResource TextSecondary}"
                                           VerticalOptions="Center"
                                           Margin="0,0,4,0"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </Grid>
        </Border>

    </Grid>
</ContentPage>